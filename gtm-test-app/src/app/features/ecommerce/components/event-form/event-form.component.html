@if (eventParameters) {
<div class="event-form">
  <div class="form-header">
    <h3>{{ eventName }} Form</h3>
    <button type="button" (click)="fillWithDefaults()" class="fillout-button">âœ¨ Fill Out</button>
  </div>

  <form [formGroup]="eventForm" (ngSubmit)="onSubmit()">
    <!-- Event-specific fields -->
    <div class="form-section">
      <h4>Event Parameters</h4>

      @for (field of eventParameters; track field.name) {
      <div class="form-group">
        <label [for]="field.name">
          {{ field.label }}
          @if (field.required) {
          <span class="required">*</span>
          }
        </label>

        @if (field.type !== 'select') {
        <input
          [id]="field.name"
          [type]="field.type"
          [formControlName]="field.name"
          [placeholder]="field.placeholder || ''"
        />
        } @if (field.type === 'select') { @let options = getFieldOptions(field); @if (options) {
        <select [formControlName]="field.name">
          @for (opt of options; track opt.value) {
          <option [value]="opt.value">
            {{ opt.label }}
          </option>
          }
        </select>
        } } @if (eventForm.get(field.name)?.invalid && eventForm.get(field.name)?.touched) {
        <div class="error">Invalid {{ field.label }}</div>
        }
      </div>
      }
    </div>

    <!-- Items Array -->
    <div class="form-section">
      <app-item-editor [parentForm]="eventForm"></app-item-editor>
    </div>

    <!-- Submit Button -->
    <div class="form-actions">
      <button
        type="button"
        (click)="onPreview()"
        class="preview-button"
        [disabled]="eventForm.invalid"
      >
        Preview Payload
      </button>
      <button type="submit" class="submit-button" [disabled]="eventForm.invalid || isSubmitting">
        Push to DataLayer
      </button>
    </div>

    @if (eventForm.invalid && eventForm.touched) {
    <div class="form-error">Please fill in all required fields and add at least one item.</div>
    }
  </form>
</div>
}
